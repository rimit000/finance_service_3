{% extends 'base.html' %}
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='style.css') }}"
/>
{% block title %}내 상품, 이자 얼MOA?{% endblock %}

{% block content %}
<style>
  .moa-header {
    transform: translateY(-1cm);
    background: white;
    padding: 80px 20px 20px;
    text-align: center;
    font-family: 'NoonnuBasicGothic', sans-serif;
  }

  .moa-header h1 {
    font-size: 5rem;
    font-weight: 700;
    color: #00C4A8;
    letter-spacing: 1.5px;
  }

  .moa-header h1 span {
    color: #8AE2BB;
    font-weight: 700;
  }

  .moa-header p {
    font-size: 1.5rem;
    color: #717171;
    margin-top: 10px;
    letter-spacing: 1.1px;
  }

  .moa-bar {
    width: 53px;
    height: 10px;
    background-color: #8AE4D7;
    margin: 20px auto 30px;
  }
</style>

<!-- 상단 제목 영역 -->
<div class="moa-header">
  <div class="moa-bar"></div>
  <h1><span>내 상품,</span> 이자 얼MOA?</h1>
  <p>내가 가진 금융 상품, 여기서 바로 이자 계산 끝!</p>
</div>

<div class="container py-5" data-bs-theme="auto">
    <h1 class="text-center fw-bold mb-5 text-primary-emphasis">내 상품, 이자 얼MOA?</h1>

    <div class="row g-4">
        <!-- 단리 계산기 -->
        <div class="col-md-4">
            <div class="card h-100 border-info shadow-sm bg-body-secondary">
                <div class="card-body">
                    <h4 class="card-title text-info text-center fw-bold">예금 계산기</h4>
                    <form id="simpleInterestForm">
                        <input type="number" class="form-control my-2" placeholder="예치 금액" name="monthly">
                        <input type="number" class="form-control my-2" placeholder="연 이자율" name="rate">
                        <input type="number" class="form-control my-2" placeholder="예금 기간(월)" name="months">
                        <button class="btn btn-outline-info w-100 mt-2 fw-semibold" type="button" onclick="calcSimple()">계산하기</button>
                        <p class="mt-3 text-center fw-semibold" id="simpleResult"></p>
                    </form>
                </div>
            </div>
        </div>

        <!-- 복리 계산기 -->
        <div class="col-md-4">
            <div class="card h-100 border-success shadow-sm bg-body-secondary">
                <div class="card-body">
                    <h4 class="card-title text-success text-center fw-bold">적금 계산기</h4>
                    <form id="compoundInterestForm">
                        <input type="number" class="form-control my-2" placeholder="월 납입액" name="monthly">
                        <input type="number" class="form-control my-2" placeholder="연 이자율" name="rate">
                        <input type="number" class="form-control my-2" placeholder="적립 기간" name="months">
                        <button class="btn btn-outline-success w-100 mt-2 fw-semibold" type="button" onclick="calcCompound()">계산하기</button>
                        <p class="mt-3 text-center fw-semibold" id="compoundResult"></p>
                    </form>
                </div>
            </div>
        </div>

        <!-- 대출 계산기 -->
        <div class="col-md-4">
            <div class="card h-100 border-danger shadow-sm bg-body-secondary">
                <div class="card-body">
                    <h4 class="card-title text-danger text-center fw-bold">대출 계산기</h4>
                    <form id="loanForm">
                        <input type="number" class="form-control my-2" placeholder="대출 금액" name="loan">
                        <input type="number" class="form-control my-2" placeholder="대출 금리" name="rate">
                        <input type="number" class="form-control my-2" placeholder="대출 기간(월)" name="months">
                        <select class="form-select my-2" name="type">
                            <option value="equal_payment">원리금균등</option>
                            <option value="equal_principal">원금균등</option>
                            <option value="bullet">만기일시상환</option>
                        </select>
                        <button class="btn btn-outline-danger w-100 mt-2 fw-semibold" type="button" onclick="calcLoan()">계산하기</button>
                        <p class="mt-3 text-center fw-semibold" id="loanResult"></p>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function calcSimple() {
    const form = document.forms["simpleInterestForm"];
    const m = parseFloat(form["monthly"].value);
    const r = parseFloat(form["rate"].value) / 100;
    const n = parseFloat(form["months"].value);

    const totalInterest = m * n * r * (n + 1) / (2 * 12);
    const totalPrincipal = m * n;
    const totalPreTax = totalPrincipal + totalInterest;
    const tax = totalInterest * 0.154;
    const totalAfterTax = totalPrincipal + (totalInterest - tax);

    document.getElementById("simpleResult").innerText =
        `세전 수령액: ${Math.round(totalPreTax).toLocaleString()}원, 세후 수령액: ${Math.round(totalAfterTax).toLocaleString()}원`;
}

function calcCompound() {
    const form = document.forms["compoundInterestForm"];
    const m = parseFloat(form["monthly"].value);
    const r = parseFloat(form["rate"].value) / 12 / 100;
    const n = parseInt(form["months"].value);

    let totalInterest = 0;
    for (let i = 0; i < n; i++) {
        totalInterest += m * (Math.pow(1 + r, n - i) - 1);
    }
    const totalPrincipal = m * n;
    const totalPreTax = totalPrincipal + totalInterest;
    const tax = totalInterest * 0.154;
    const totalAfterTax = totalPrincipal + (totalInterest - tax);

    document.getElementById("compoundResult").innerText =
        `세전 수령액: ${Math.round(totalPreTax).toLocaleString()}원, 세후 수령액: ${Math.round(totalAfterTax).toLocaleString()}원`;
}

function calcLoan() {
    const form = document.forms["loanForm"];
    const P = parseFloat(form["loan"].value) * 10000;
    const annualRate = parseFloat(form["rate"].value);
    const r = annualRate / 12 / 100;
    const n = parseInt(form["months"].value);
    const type = form["type"].value;

    let totalRepayment = 0;
    let totalInterest = 0;

    if (type === "equal_payment") {
        const A = P * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
        totalRepayment = A * n;
        totalInterest = totalRepayment - P;
        document.getElementById("loanResult").innerText =
            ` 매월 상환금: ${Math.round(A).toLocaleString()}원, 총이자: ${Math.round(totalInterest).toLocaleString()}원, 총상환액: ${Math.round(totalRepayment).toLocaleString()}원`;
    } else if (type === "equal_principal") {
        let total = 0;
        const principalPart = P / n;
        for (let i = 0; i < n; i++) {
            const interestPart = (P - (principalPart * i)) * r;
            total += principalPart + interestPart;
        }
        totalRepayment = total;
        totalInterest = total - P;
        document.getElementById("loanResult").innerText =
            ` 초기 상환금: ${Math.round(principalPart + P * r).toLocaleString()}원, 총이자: ${Math.round(totalInterest).toLocaleString()}원, 총상환액: ${Math.round(totalRepayment).toLocaleString()}원`;
    } else if (type === "bullet") {
        const monthlyInterest = P * r;
        totalInterest = monthlyInterest * n;
        totalRepayment = P + totalInterest;
        document.getElementById("loanResult").innerText =
            ` 매월 이자: ${Math.round(monthlyInterest).toLocaleString()}원, 총이자: ${Math.round(totalInterest).toLocaleString()}원, 총상환액: ${Math.round(totalRepayment).toLocaleString()}원`;
    }
}
</script>
{% endblock %}
