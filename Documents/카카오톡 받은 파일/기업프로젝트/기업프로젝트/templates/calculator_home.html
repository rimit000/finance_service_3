{% extends 'base.html' %}

{% block title %}내 상품, 이자 얼MOA?{% endblock %}

{% block content %}
<style>
  :root {

    --moa-green: #00C4A8;
    --moa-light: #8AE2BB;
    --moa-dark: #020715;

    --card-border-width: 1.5px;
    --card-border-radius: 0.5rem;
    --card-padding: 3rem;
    --card-bg: #FFFFFF;
    --card-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.1);
    --card-border-info: #CFCFCF;
    --card-border-success: #198754;
    --card-border-danger: #dc3545;
  }

  .moa-header {
    transform: translateY(-1cm);
    background: white;
    padding: 80px 20px 20px;
    text-align: center;
    font-family: 'NoonnuBasicGothic', sans-serif;
  }
  .moa-header .moa-bar {
    width: 53px;
    height: 10px;
    background-color: var(--moa-light);
    margin: 0 auto 30px;
  }
  .moa-header h1 {
    font-size: 4rem;
    font-weight: 700;
    color: var(--moa-green);
    letter-spacing: 1.5px;
  }
  .moa-header h1 span {
    color: var(--moa-light);
  }
  .moa-header p {
    font-size: 1.5rem;
    color: #717171;
    margin-top: 10px;
    letter-spacing: 1.1px;
  }

  .nav-tabs {
    transform: translateY(-1cm);
    justify-content: center;
    border-bottom: none;
    font-family: 'NoonnuBasicGothic', sans-serif;
  }
  .nav-tabs .nav-link {
    color: #717171;
    font-size: 1.5rem;
    border: none;
    padding: 0.5rem 8rem;
  }
  .nav-tabs .nav-link.active {
    color: var(--moa-green);
    border-bottom: 2px solid var(--moa-green);
  }


  .calc-card {
    border-width: var(--card-border-width) !important;
    border-style: solid !important;
    border-radius: var(--card-border-radius) !important;
    background-color: var(--card-bg) !important;
    box-shadow: var(--card-shadow) !important;
  }
  .calc-card .card-body {
    padding: var(--card-padding) !important;
  }

  .calc-card .card-title {
    color: #251C1C !important;
    margin-bottom: 0.7cm;
    font-size: 1.8rem;
  }

  .calc-card.info { border-color: var(--card-border-info) !important; }

  .btn-fill-dark {
    height: 45px;
    font-size: 25px;
    --bs-btn-bg: #8AE2BB;
    --bs-btn-border-color: none !important;
    --bs-btn-color: #020715;
  }

    .result-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 2rem;
    font-size: 1rem;
    /* 테이블이 가로로 넘칠 때 스크롤 */
    overflow-x: auto;
    }

    .result-table th,
    .result-table td {
    border: 1px solid #ccc;
    padding: .5rem 1.5rem;
    text-align: center;       
    white-space: nowrap;      
    word-break: keep-all;   
    }

    .result-table th {
    background: #ccc;
    }

</style>

<!-- 상단 헤더 -->
<div class="moa-header">
  <div class="moa-bar"></div>
  <h1><span>내 상품,</span> 이자 얼MOA?</h1>
  <p>내가 가진 금융 상품, 여기서 바로 이자 계산 끝!</p>
</div>

<div class="container py-5" data-bs-theme="auto">
  <!-- 탭 메뉴 -->
  <ul class="nav nav-tabs mb-4" id="calcTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="simple-tab" data-bs-toggle="tab" data-bs-target="#simple" type="button">예금</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="compound-tab" data-bs-toggle="tab" data-bs-target="#compound" type="button">적금</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="loan-tab" data-bs-toggle="tab" data-bs-target="#loan" type="button">대출</button>
    </li>
  </ul>

  <div class="tab-content">
    <!-- 예금 계산기 -->
    <div class="tab-pane fade show active" id="simple" role="tabpanel">
      <div class="row justify-content-center">
        <div class="col-md-6">

          <!-- 입력 폼 카드 -->
          <div class="card calc-card info">
            <div class="card-body">
              <h4 class="card-title text-right fw-bold">예금 계산기</h4>
              <form id="simpleInterestForm">
                <input type="number" class="form-control my-2" placeholder="예치 금액" name="principal">
                <input type="number" class="form-control my-2" placeholder="연 이자율(%)" name="rate">
                <input type="number" class="form-control my-2" placeholder="예금 기간(월)" name="months">
                <button class="btn btn-info btn-fill-dark w-100 mt-2 fw-semibold" type="button" onclick="calcSimple()">계산하기</button>
              </form>
              <p class="mt-3 text-center fw-semibold" id="simpleResult"></p>
            </div>
          </div>

          <!-- 결과 테이블 -->
          <div id="simpleResultTable" class="mt-4">
            <table class="result-table">
              <thead>
                <tr>
                  <th>구분</th>
                  <th>월납입액 합계(원)</th>
                  <th>이자(세전, 원)</th>
                  <th>이자(세후, 원)</th>
                  <th>만기지급액(원)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>일반 (<span id="taxNormalRate">15.4</span>%)</td>
                  <td id="normalPrincipal">0</td>
                  <td id="normalInterestBefore">0</td>
                  <td id="normalInterestAfter">0</td>
                  <td id="normalMature">0</td>
                </tr>
                <tr>
                  <td>비과세 (0.0%)</td>
                  <td id="nonePrincipal">0</td>
                  <td id="noneInterestBefore">0</td>
                  <td id="noneInterestAfter">0</td>
                  <td id="noneMature">0</td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>

    <!-- 적금 계산기 -->
    <div class="tab-pane fade" id="compound" role="tabpanel">
      <div class="row justify-content-center">
        <div class="col-md-6">

          <!-- 입력 폼 카드 -->
          <div class="card calc-card info">
            <div class="card-body">
              <h4 class="card-title text-right fw-bold">적금 계산기</h4>
              <form id="compoundInterestForm">
                <input type="number" class="form-control my-2" placeholder="월 납입액" name="monthly">
                <input type="number" class="form-control my-2" placeholder="연 이자율(%)" name="rate">
                <input type="number" class="form-control my-2" placeholder="적립 기간(월)" name="months">
                <button class="btn btn-info btn-fill-dark w-100 mt-2 fw-semibold" type="button" onclick="calcCompound()">계산하기</button>
              </form>
              <p class="mt-3 text-center fw-semibold" id="compoundResult"></p>
            </div>
          </div>

          <!-- 결과 테이블 -->
          <div id="compoundResultTable" class="mt-4">
            <table class="result-table">
              <thead>
                <tr>
                  <th>구분</th>
                  <th>월납입액 합계(원)</th>
                  <th>이자(세전, 원)</th>
                  <th>이자(세후, 원)</th>
                  <th>만기지급액(원)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>일반 (<span id="compoundTaxRate">15.4</span>%)</td>
                  <td id="compoundNormalPrincipal">0</td>
                  <td id="compoundInterestBefore">0</td>
                  <td id="compoundInterestAfter">0</td>
                  <td id="compoundMature">0</td>
                </tr>
                <tr>
                  <td>비과세 (0.0%)</td>
                  <td id="compoundNonePrincipal">0</td>
                  <td id="compoundNoneInterestBefore">0</td>
                  <td id="compoundNoneInterestAfter">0</td>
                  <td id="compoundNoneMature">0</td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>

    <!-- 대출 계산기 -->
    <div class="tab-pane fade" id="loan" role="tabpanel">
      <div class="row justify-content-center">
        <div class="col-md-6">

          <!-- 입력 폼 카드 -->
          <div class="card calc-card info">
            <div class="card-body">
              <h4 class="card-title text-right fw-bold">대출 계산기</h4>
              <form id="loanForm">
                <input type="number" class="form-control my-2" placeholder="대출 금액" name="loan">
                <input type="number" class="form-control my-2" placeholder="대출 금리(%)" name="rate">
                <input type="number" class="form-control my-2" placeholder="대출 기간(월)" name="months">
                <select class="form-select my-2" name="type">
                  <option value="equal_payment">원리금균등</option>
                  <option value="equal_principal">원금균등</option>
                  <option value="bullet">만기일시상환</option>
                </select>
                <button class="btn btn-info btn-fill-dark w-100 mt-2 fw-semibold" type="button" onclick="calcLoan()">계산하기</button>
              </form>
              <p class="mt-3 text-center fw-semibold" id="loanResult"></p>
            </div>
          </div>

          <!-- 결과 테이블 -->
          <div id="loanResultTable" class="mt-4">
            <table class="result-table">
              <thead>
                <tr>
                  <th>회차</th>
                  <th>상환금(원)</th>
                  <th>납입원금(원)</th>
                  <th>이자(원)</th>
                  <th>납입원금 누계(원)</th>
                  <th>잔금(원)</th>
                </tr>
              </thead>
              <tbody id="loanScheduleBody">
                <!-- JS로 채워집니다 -->
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>


<script type="text/javascript" src="https://simg.wooribank.com/js/mall/caculator_new.js?1362234790000"></script>
<script>
function calcSimple() {
    const form = document.forms["simpleInterestForm"];
    const m = parseFloat(form["monthly"].value);
    const r = parseFloat(form["rate"].value) / 100;
    const n = parseFloat(form["months"].value);

    const totalInterest = m * n * r * (n + 1) / (2 * 12);
    const totalPrincipal = m * n;
    const totalPreTax = totalPrincipal + totalInterest;
    const tax = totalInterest * 0.154;
    const totalAfterTax = totalPrincipal + (totalInterest - tax);

    document.getElementById("simpleResult").innerText =
        `세전 수령액: ${Math.round(totalPreTax).toLocaleString()}원, 세후 수령액: ${Math.round(totalAfterTax).toLocaleString()}원`;
}

function calcCompound() {
    const form = document.forms["compoundInterestForm"];
    const m = parseFloat(form["monthly"].value);
    const r = parseFloat(form["rate"].value) / 12 / 100;
    const n = parseInt(form["months"].value);

    let totalInterest = 0;
    for (let i = 0; i < n; i++) {
        totalInterest += m * (Math.pow(1 + r, n - i) - 1);
    }
    const totalPrincipal = m * n;
    const totalPreTax = totalPrincipal + totalInterest;
    const tax = totalInterest * 0.154;
    const totalAfterTax = totalPrincipal + (totalInterest - tax);

    document.getElementById("compoundResult").innerText =
        `세전 수령액: ${Math.round(totalPreTax).toLocaleString()}원, 세후 수령액: ${Math.round(totalAfterTax).toLocaleString()}원`;
}

function calcLoan() {
    const form = document.forms["loanForm"];
    const P = parseFloat(form["loan"].value) * 10000;
    const annualRate = parseFloat(form["rate"].value);
    const r = annualRate / 12 / 100;
    const n = parseInt(form["months"].value);
    const type = form["type"].value;

    let totalRepayment = 0;
    let totalInterest = 0;

    if (type === "equal_payment") {
        const A = P * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
        totalRepayment = A * n;
        totalInterest = totalRepayment - P;
        document.getElementById("loanResult").innerText =
            ` 매월 상환금: ${Math.round(A).toLocaleString()}원, 총이자: ${Math.round(totalInterest).toLocaleString()}원, 총상환액: ${Math.round(totalRepayment).toLocaleString()}원`;
    } else if (type === "equal_principal") {
        let total = 0;
        const principalPart = P / n;
        for (let i = 0; i < n; i++) {
            const interestPart = (P - (principalPart * i)) * r;
            total += principalPart + interestPart;
        }
        totalRepayment = total;
        totalInterest = total - P;
        document.getElementById("loanResult").innerText =
            ` 초기 상환금: ${Math.round(principalPart + P * r).toLocaleString()}원, 총이자: ${Math.round(totalInterest).toLocaleString()}원, 총상환액: ${Math.round(totalRepayment).toLocaleString()}원`;
    } else if (type === "bullet") {
        const monthlyInterest = P * r;
        totalInterest = monthlyInterest * n;
        totalRepayment = P + totalInterest;
        document.getElementById("loanResult").innerText =
            ` 매월 이자: ${Math.round(monthlyInterest).toLocaleString()}원, 총이자: ${Math.round(totalInterest).toLocaleString()}원, 총상환액: ${Math.round(totalRepayment).toLocaleString()}원`;
    }
}
</script>
{% endblock %}
